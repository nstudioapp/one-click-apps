name: Publish One Click Apps

on:
name: Validate, Build & Deploy
on:
  workflow_dispatch: { }
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  validate-build-deploy:
    runs-on: ubuntu-latest
    steps:

      -   name: Checkout 🛎️
          uses: actions/checkout@v2

      -   name: Restore Cache ♻
          uses: actions/cache@v2
          with:
            path: ~/.pnpm-store
            key: ${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}
            restore-keys: |
              ${{ runner.os }}-

      -   name: Setup 🔧
          uses: pnpm/action-setup@v2.0.1
          with:
            version: 6.22.2
            run_install: true

      -   name: Validate 🔎
          run: pnpm run validate

      -   name: Build 🏗
          if: ${{ github.event_name == 'push' }}
          run: pnpm run build

      -   name: Deploy 🚀
          if: ${{ github.event_name == 'push' }}
          uses: JamesIves/github-pages-deploy-action@4.1.5
          with:
            branch: gh-pages
            folder: dist
            git-config-name: SkayoBot
            git-config-email: frederike.gnampf@gmail.com
            clean: true  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-node@v3.5.1
        with:
          node-version: 16
      - run: npm ci && npm run publish
        env:
          GITHUB_PERSONAL_TOKEN: ${{secrets.GITHUB_PERSONAL_TOKEN}}
